# 运作总述

边界网关协议（BGP）是一种自治系统间路由协议。它建立在从 EGP 获取的经验之上（EGP 的定义在 [[RFC904](https://www.rfc-editor.org/rfc/rfc904.html)] 中），而 EGP 用于 NSFNET 的骨干网络（详见 [[RFC1092](https://www.rfc-editor.org/rfc/rfc1092.html)] 和 [[RFC1093](https://www.rfc-editor.org/rfc/rfc1093.html)]）。倘若要获得更多与 BGP 相关的信息，请参阅 [[RFC1772](https://www.rfc-editor.org/rfc/rfc1772.html)]，[[RFC1930](https://www.rfc-editor.org/rfc/rfc1930.html)]，和 [[RFC2858](https://www.rfc-editor.org/rfc/rfc2858.html)]。

BGP 对话系统的主要功能是与其它 BGP 系统交换网络可达性信息。这些网络可达性信息包含可达性信息经过的自治系统（ASes）列表。这些信息足以构建自治系统的连接性拓扑图以便剔除可能导致环路的可达性信息。以及，在自治系统级别，一些策略决定可能是强制性的。

在本文档的上下文中，我们预设一个 BGP Speaker 只向它的对等体广播它自己使用的路由（在该上下文中，一个 BGP Speaker “使用” BGP 路由是指将它指定为最优路由并用于流量转发）。所有除此之外的情况不在本文的讨论范围之内。

在本文档的上下文中，“IP 地址”一词的指的是一个 IPv4 地址 [[RFC791](https://www.rfc-editor.org/rfc/rfc791.html)]。

通过 BGP 进行的路由信息交换仅支持基于目的的转发实例，这预设一台路由器只基于 IP 报文头中的目的地址进行报文转发。如此，依次地，与一组策略决策的映射可（或不可）由 BGP 执行。BGP 仅支持那些与基于目的的转发实例相适应的策略。请注意，一些策略无法被基于目的的转发实例支持，且需要基于源地址的路由技术（如显式路径）以执行。这样的策略是无法用 BGP 执行的。例如，BGP 并不能使一个 AS 在向邻居 AS 转发到一些跨越该邻居 AS 的可达目的地的流量时，令流量有和邻居 AS 始发流量不同的路由（同一目的地）。另一方面，BGP 可支持任意能够适应基于目的地转发范式的策略。

BGP-4 提供了新的一套机制以供支持无类域间路由（Classless Inter-Domain Routing, CIDR）[[RFC1518](https://www.rfc-editor.org/rfc/rfc1518.html)，[RFC1519](https://www.rfc-editor.org/rfc/rfc1519.html)]。这套机制包括对将一组 IP 前缀作为目的地广播的支持和对 BGP 之中的网络“类”的概念的消除。BGP-4 还引入了允许路由聚合的机制，也包括对自治系统路径的聚合能力。

本文档通篇使用的术语“自治系统”（Autonomous System, AS）。它的经典定义为对一个自治系统的经典定义为一组归同一技术团队管理，使用内部网关协议（Interior Gateway Protocol, IGP）和通用度量值（metrics）以进行自治系统内路由决策的路由器，并且使用自治系统间路由协议以对自治系统间的报文路由进行决策。鉴于经典定义已有历史，现在在单个 AS 内部使用多种 IGP ，甚至有时有数组度量值设定也已是常见的。对自治系统这一术语的使用所强调的事实，甚至适用于使用多种 IGP ，具有多种 metric 设定，管理权跨越多个 AS 并执行统一的内部路由计划，并在其可达的目标路由上表达出一致的可达性的情况。

BGP 使用 TCP [[RFC793](https://www.rfc-editor.org/rfc/rfc793.html)] 作为其传输协议。这解决了对显式更新分片，重传，应答和排序的实现的需要。BGP 监听 TCP 179 端口。BGP 使用的错误提示机制预设 TCP 支持“优雅的”关闭（即所有未完成的数据传输都会在连接关闭前完成）。

一条 TCP 连接会在两个系统间建立。它们会交换报文来开放连接和确认连接参数。

初始的数据流用于导出 BGP 路由表被导出策略允许的路由，这部分路由称之为 Adj-Ribs-Out （详见 [3.2](3.2.md)）。路由表更新通过增量更新的方式进行。BGP 不需要对路由表进行周期性的更新。为允许在不重置任何 BGP 连接的情况下使本地策略更改能够正确生效，一个 BGP Speaker **应该**在连接期间保留现有版本的被广播到所有对等体的路由（a），或使用路由刷新拓展 [[RFC2918](https://www.rfc-editor.org/rfc/rfc2918.html)]（b）。

可通过周期性发送 KEEPALIVE 报文以确保连接的活跃。发送 NOTIFICATION 报文是为了报告错误或特殊情况。如果一条连接陷入了错误情况，将会发送一个 NOTIFICATION 报文并关闭连接。

在不同自治系统间的对等互联被成为外部对等，与之相对的是在同一自治系统内的对等互联，被称为内部对等。内部 BGP 和外部 BGP 被简写为 IBGP 和 EBGP 。

如果一个特定的 AS 具有多个 BGP Speaker 并向其它 AS 提供 Transit 服务，那么它就必须确保 AS 内部具有一致的路由。由 IGP 提供的一致的内部路由用于 AS 内部。在本文档的用意之下，预设在同一 AS 的外部路由通过在同一 AS 内所有 BGP Speaker 之间建立 IBGP 连接以保持一致。

本文档定义了 BGP 协议的基本行为。这种行为将会，并且正在通过拓展规范进行修改。当该协议得到拓展，新的行为将会在拓展规范的文档中完全记录。