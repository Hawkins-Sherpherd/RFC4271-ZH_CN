# OPEN 报文格式

在 TCP 连接建立后，双端发送的第一个报文便是 OPEN 报文。如果 OPEN 报文被接受，那么一个 KEEPALIVE 报文将在 OPEN 被确认后发至对方。

除了固定尺寸的 BGP 报文头外，OPEN 报文还包含了如下字段：

```
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+
|    Version    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     My Autonomous System      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Hold Time           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         BGP Identifier                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Opt Parm Len  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|             Optional Parameters (variable)                    |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

&emsp;

## 版本（Version）：

这个1八位元长度的无符号整数表示这个报文的协议版本号，现在的 BGP 版本号为4。

&emsp;

## 本自治系统（My Autonomous System）：

这个2八位元长度的无符号整数表示发送者的自治系统号码。

&emsp;

## 保持时间（Hold Time）：

这个2八位元长度的无符号整数表示发送者所提出的以秒为单位的保持计时器（Hold Timer）值设定。在收到一个 OPEN 报文后，BGP Speaker **必须**通过使用配置的值和收到的值之中较小的一个值以得出保持计时器的值。保持时间**必须**不为零且至少为三秒。一个实现**可能**因为保持时间的原因拒绝连接。得到的值表示从发送者收到连续的 KEEPALIVE 或/和 UPDATE 报文的以秒为单位的最大间隔时间。

&emsp;

## BGP 标识（BGP Identifier）：

这个4八位元长度的无符号整数表示发送者的 BGP 标识。一个给定的 BGP Speaker 设定该值为一个分配到该 BGP Speaker 上的 IP 地址。BGP 标识的值在启动阶段便已决定，并对所有本地接口和 BGP 对等体保持一致。

&emsp;

## 可选参数长度（Optional Parameters Length）：

这个1八位元长度的无符号整数表示可选参数字段以八位元为单位的总长度。如果该字段的值为0，则意味着没有使用可选参数。

&emsp;

## 可选参数（Optional Parameters）：

这个字段包含了一个可选参数的列表，每个参数都编排为 <参数类型，参数长度，参数值> 的三元组。

```
0                   1
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...
|  Parm. Type   | Parm. Length  |  Parameter Value (variable)
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...
```

参数类型（Parameter Type）是一个无歧义地定义一个参数的1八位元长度字段。参数长度（Parameter Length）是一个以八位元为单位表示参数值字段长度的1八位元长度字段。参数值（Parameter Value）是一个可变长的由参数类型字段解释其值意义的字段。

[[RFC3392](https://www.rfc-editor.org/rfc/rfc3392.html)]定义了兼容性可选参数。

OPEN 报文的最小长度为 29 个八位元（包含报文头在内）。