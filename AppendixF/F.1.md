# 每个报文传递多个网络信息

BGP 协议允许多个具有相同路径属性的地址前缀出现在同一个报文里。使用这项特性是高度推荐的。每个报文一个地址前缀的情况会大量增加开销。不只是由于更多的报文导致的开销，还有因为对每个报文的处理的相关流程，如扫描路由表以将更新推送至 BGP 对等体和其它路由协议（以及发送相关的报文）导致的额外系统开销。

一种构建包含许多在路由表中并未基于同一路径属性组的设定组织的使用同一路径属性组的地址前缀的报文的方法是，一边扫描路由表一边构建许多报文。在地址前缀在处理时，将会为与之关联的路径属性分配报文，如果它不存在的话，而新的地址前缀将添加到其中。如果这样的报文存在，那么新的地址前缀会附加到它后面。如果报文没有足够空间容纳新的地址前缀，那么就会传输出去，然后分配新的报文，新的前缀会插入到新的报文中。当整个路由表都被扫描过后，所有分配的报文都被发送，而它们占用的资源会被释放。当地址前缀能够覆盖的所有目的地共享一组相同的公共路径属性的时，便能达到最大的压缩效果，从而能够在一个4096字节的报文中发送许多地址前缀。

与一个不将多个地址前缀压缩到一个报文里的 BGP 实现对等互联时，可能需要采取以下步骤以减少在与对等体建立互联或是网络拓扑变更时接收的数据泛洪造成的开销。一种方法是限制更新的频率。这将消除为向 BGP 对等体和其它路由协议提供快速更新而产生的冗余的路由表扫描。一个关于该方法的坏处便是这增加了路由信息传播的延迟。通过选择最小的不显著大于处理多个报文所需时间的快速更新间隔，这种延迟可降到最低。一个更好的方法就是在发送更新前读取所有接收到的报文。